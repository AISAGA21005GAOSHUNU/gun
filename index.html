<!doctype html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å›¾ç‰‡è¯†å­—ï¼šæªçš„ä¸­æ–‡ï¼ˆä¸¤äººå¯¹æˆ˜ï¼‰</title>

<style>
  :root{
    --ink:#0b1220;
    --card: rgba(255,255,255,.86);
    --line: rgba(255,255,255,.16);
    --shadow: 0 18px 50px rgba(0,0,0,.28);
    --radius: 22px;

    --p1:#2563eb;
    --p2:#ef4444;
    --good: rgba(34,197,94,.18);
    --bad: rgba(239,68,68,.16);
    --accent: rgba(250,204,21,.18);
  }

  body{
    margin:0;
    font-family: system-ui, -apple-system, "Noto Sans SC","PingFang SC", Arial, sans-serif;
    color: #0b1220;
    background:
      radial-gradient(1200px 600px at 15% 20%, rgba(34,197,94,.25), transparent 60%),
      radial-gradient(900px 500px at 90% 15%, rgba(250,204,21,.22), transparent 58%),
      radial-gradient(1000px 600px at 70% 85%, rgba(14,165,233,.18), transparent 60%),
      radial-gradient(140px 110px at 12% 36%, rgba(20,83,45,.55), transparent 70%),
      radial-gradient(190px 140px at 23% 66%, rgba(30,64,175,.18), transparent 70%),
      radial-gradient(210px 160px at 38% 45%, rgba(124,45,18,.24), transparent 70%),
      radial-gradient(160px 120px at 58% 28%, rgba(20,83,45,.45), transparent 70%),
      radial-gradient(220px 170px at 72% 56%, rgba(63,98,18,.40), transparent 70%),
      radial-gradient(200px 150px at 88% 44%, rgba(120,53,15,.28), transparent 70%),
      linear-gradient(135deg, #0b1a12, #0b1220);
    min-height:100vh;
  }

  header{
    position:sticky; top:0; z-index:30;
    backdrop-filter: blur(10px);
    background: linear-gradient(180deg, rgba(0,0,0,.58), rgba(0,0,0,.25));
    border-bottom: 1px solid rgba(255,255,255,.10);
  }

  .wrap{max-width:1220px; margin:0 auto; padding:14px 18px;}
  .top{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;}

  .title{display:flex; align-items:baseline; gap:10px; flex-wrap:wrap; color:#e5e7eb;}
  h1{margin:0; font-size:22px; letter-spacing:.3px;}
  .sub{font-size:14px; color: rgba(226,232,240,.86)}

  .controls{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
  .chip{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 12px; border-radius:999px;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.16);
    color:#e5e7eb; font-size:14px;
  }

  select{
    font-size:14px;
    padding:9px 10px;
    border-radius:12px;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.25);
    color:#f8fafc;
    outline:none;
  }

  .btn{
    font-size:16px;
    padding:10px 14px;
    border-radius:14px;
    border: 1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,.12);
    color:#f8fafc;
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
  }
  .btn:hover{ transform: translateY(-1px); box-shadow: 0 12px 26px rgba(0,0,0,.25); background: rgba(255,255,255,.18);}
  .btn:active{ transform: translateY(0px) scale(.99); }

  main .grid{
    max-width:1220px;
    margin:16px auto 26px;
    padding:0 18px;
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap:18px;
  }
  @media (max-width:980px){ main .grid{ grid-template-columns: 1fr; } }

  .card{
    border-radius: var(--radius);
    background: var(--card);
    border: 1px solid rgba(255,255,255,.22);
    box-shadow: var(--shadow);
    padding:18px;
  }

  .media{
    height:460px;
    border-radius:18px;
    border: 1px dashed rgba(0,0,0,.18);
    background: rgba(255,255,255,.55);
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
  }
  .media img{
    width:100%; height:100%;
    object-fit:contain;
    padding:14px;
  }

  .hud{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
    margin-bottom:12px;
  }

  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 12px; border-radius:999px;
    background: rgba(15,23,42,.06);
    border: 1px solid rgba(15,23,42,.10);
    font-size:14px;
  }
  .pill strong{font-size:16px;}

  .turn{
    display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    margin-bottom:10px;
  }
  .tag{
    display:inline-flex; align-items:center; gap:8px;
    padding:10px 12px; border-radius:999px;
    border: 1px solid rgba(2,6,23,.10);
    background: rgba(255,255,255,.88);
    font-size:14px;
  }
  .tag .dot{
    width:10px; height:10px; border-radius:999px;
    background: #94a3b8;
  }
  .tag.p1 .dot{ background: var(--p1); }
  .tag.p2 .dot{ background: var(--p2); }

  .tag.active{
    outline: 3px solid rgba(250,204,21,.35);
    box-shadow: 0 10px 22px rgba(0,0,0,.12);
    transform: translateY(-1px);
  }

  .barWrap{
    width:100%; height:12px;
    border-radius:999px;
    background: rgba(2,6,23,.08);
    border: 1px solid rgba(2,6,23,.08);
    overflow:hidden;
    margin:10px 0 14px;
  }
  .bar{
    height:100%;
    width:0%;
    border-radius:999px;
    background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(250,204,21,.95));
    transition: width .25s ease;
  }

  .promptRow{
    display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
  }
  .bigWord{
    font-size:22px; font-weight:900;
    padding:10px 14px; border-radius:16px;
    background: rgba(2,6,23,.04);
    border: 1px solid rgba(2,6,23,.08);
  }
  .iconBtn{
    font-size:16px;
    padding:10px 12px;
    border-radius:14px;
    border: 1px solid rgba(2,6,23,.12);
    background: rgba(255,255,255,.92);
    cursor:pointer;
  }

  .choices{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
    margin-top:12px;
  }
  .choice{
    width:100%;
    font-size:22px;
    font-weight:900;
    padding:16px 16px;
    border-radius:18px;
    border: 1px solid rgba(2,6,23,.14);
    background: rgba(255,255,255,.92);
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
    text-align:center;
  }
  .choice:hover{ transform: translateY(-1px); box-shadow: 0 12px 22px rgba(0,0,0,.14); background:#fff; }
  .choice:active{ transform: translateY(0px) scale(.99); }
  .choice.wrong{
    border-color: rgba(239,68,68,.35);
    background: rgba(239,68,68,.08);
    animation: shake .22s ease-in-out 0s 2;
  }
  @keyframes shake{
    0%{ transform: translateX(0); }
    25%{ transform: translateX(-6px); }
    50%{ transform: translateX(6px); }
    75%{ transform: translateX(-4px); }
    100%{ transform: translateX(0); }
  }

  .msg{
    margin-top:14px;
    padding:14px 14px;
    border-radius:16px;
    border: 1px solid rgba(2,6,23,.10);
    background: rgba(255,255,255,.85);
    min-height:64px;
    font-size:16px;
    line-height:1.5;
  }
  .msg.ok{ background: var(--good); border-color: rgba(34,197,94,.26); }
  .msg.bad{ background: var(--bad); border-color: rgba(239,68,68,.20); }

  .tiny{
    margin-top:10px;
    font-size:12px;
    color: rgba(15,23,42,.70);
    line-height:1.45;
  }

  .scoreBoard{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin-top:10px;
  }
  .sb{
    border-radius:18px;
    padding:12px 12px;
    border: 1px solid rgba(2,6,23,.10);
    background: rgba(255,255,255,.88);
  }
  .sb .name{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    font-weight:900; font-size:16px;
  }
  .sb .meta{
    margin-top:8px;
    display:flex; gap:10px; flex-wrap:wrap;
    font-size:13px;
    color: rgba(15,23,42,.75);
  }
  .badgeMini{
    padding:6px 10px;
    border-radius:999px;
    background: rgba(2,6,23,.04);
    border: 1px solid rgba(2,6,23,.06);
  }

  canvas#confetti{
    position:fixed; inset:0; pointer-events:none; z-index:999;
  }
</style>
</head>

<body>
<canvas id="confetti"></canvas>

<header>
  <div class="wrap top">
    <div class="title">
      <h1>å›¾ç‰‡è¯†å­—ï¼šæªçš„ä¸­æ–‡ï¼ˆä¸¤äººå¯¹æˆ˜ï¼‰</h1>
      <div class="sub">ä½ å’Œå­¦ç”Ÿè½®æµç­”é¢˜ï¼šæ¯”è°åˆ†æ•°é«˜</div>
    </div>

    <div class="controls">
      <label class="chip"><input id="ttsOn" type="checkbox" checked /> ä¸­æ–‡æœ—è¯»</label>
      <label class="chip">è¯­éŸ³ï¼š
        <select id="voiceSel" title="é€‰æ‹©ä¸­æ–‡å£°éŸ³"></select>
      </label>
      <label class="chip">è¯­é€Ÿï¼š
        <select id="rateSel" title="è¯­é€Ÿ">
          <option value="0.78">æ›´æ…¢</option>
          <option value="0.85" selected>æ…¢</option>
          <option value="0.92">æ­£å¸¸</option>
        </select>
      </label>
      <button id="swapBtn" class="btn" title="äº¤æ¢å…ˆæ‰‹">äº¤æ¢å…ˆæ‰‹</button>
      <button id="resetBtn" class="btn" title="é‡ç½®æ¯”åˆ†ä¸ç­‰çº§">é‡ç½®æ¯”èµ›</button>
      <button id="nextBtn" class="btn">ä¸‹ä¸€é¢˜</button>
    </div>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card">
      <div class="media" id="media"></div>
      <div class="tiny">è¯´æ˜ï¼šè¿™æ˜¯è¯†å­—å¯¹æˆ˜ï¼Œåªå­¦ä¹ ä¸­æ–‡è¯è¯­ä¸æ±‰å­—ã€‚</div>
    </section>

    <section class="card" id="panel">
      <div class="turn">
        <div class="tag p1 active" id="tagP1"><span class="dot"></span><span id="nameP1">è€å¸ˆ</span> å›åˆ</div>
        <div class="tag p2" id="tagP2"><span class="dot"></span><span id="nameP2">å­¦ç”Ÿ</span> å›åˆ</div>
        <div class="pill">é¢˜æ•°ï¼š<strong id="count">0</strong></div>
        <div class="pill">ç­‰çº§ï¼š<strong id="level">1</strong></div>
      </div>

      <div class="barWrap" aria-label="å‡çº§è¿›åº¦">
        <div class="bar" id="bar"></div>
      </div>

      <div class="promptRow">
        <div class="pill">æç¤ºï¼š<strong id="hint">â€”</strong></div>
        <div class="bigWord" id="focusWord">â€”</div>
        <button class="iconBtn" id="speakBtn" title="é‡æ’­æœ—è¯»">ğŸ”Š é‡æ’­</button>
      </div>

      <div class="choices" id="choices"></div>

      <div class="msg" id="msg">å‡†å¤‡å¥½äº†å—ï¼Ÿè€å¸ˆå…ˆç­”ç¬¬ä¸€é¢˜ã€‚</div>

      <div class="scoreBoard">
        <div class="sb" id="sb1">
          <div class="name">
            <span>è€å¸ˆ</span>
            <span style="color:var(--p1);font-weight:900;">P1</span>
          </div>
          <div class="meta">
            <span class="badgeMini">åˆ†æ•°ï¼š<strong id="p1Score">0</strong></span>
            <span class="badgeMini">è¿å¯¹ï¼š<strong id="p1Streak">0</strong></span>
          </div>
        </div>

        <div class="sb" id="sb2">
          <div class="name">
            <span>å­¦ç”Ÿ</span>
            <span style="color:var(--p2);font-weight:900;">P2</span>
          </div>
          <div class="meta">
            <span class="badgeMini">åˆ†æ•°ï¼š<strong id="p2Score">0</strong></span>
            <span class="badgeMini">è¿å¯¹ï¼š<strong id="p2Streak">0</strong></span>
          </div>
        </div>
      </div>

      <div class="tiny" id="ruleLine">è§„åˆ™ï¼šè½®æµç­”é¢˜ã€‚ç­”å¯¹åŠ åˆ†å¹¶å‡çº§ï¼›ç­‰çº§è¶Šé«˜é€‰é¡¹è¶Šå¤šã€æç¤ºè¶Šå°‘ã€‚</div>
    </section>
  </div>
</main>

<script>
/* ====== å›¾ç‰‡æ¥æºï¼šGitHub rawï¼ˆç¨³å®šï¼‰ ====== */
const RAW_BASE = "https://raw.githubusercontent.com/AISAGA21005GAOSHUNU/gun/main/assets/";

/* ====== è¯åº“ï¼ˆè¯†å­—ç”¨ï¼‰ ====== */
const bank = [
  { zh:"æ‰‹æª",  hint:"å°",   file:"shouqiang.png" },
  { zh:"æ­¥æª",  hint:"é•¿",   file:"buqiang.png" },
  { zh:"éœ°å¼¹æª",hint:"åµ",   file:"xiandanqiang.png" },
  { zh:"å†²é”‹æª",hint:"å¿«",   file:"chongfengqiang.png" },
  { zh:"ç‹™å‡»æª",hint:"å‡†",   file:"jujiqiang.png" },
  { zh:"æœºæª",  hint:"å¾ˆå¤§", file:"jiqiang.png" },
].map(x => ({...x, img: RAW_BASE + x.file}));

/* ====== çŠ¶æ€ï¼ˆä¸¤äººå¯¹æˆ˜ï¼‰ ====== */
let count = 0;
let level = 1;   // å…¨å±€éš¾åº¦ç­‰çº§ï¼ˆä¸¤äººä¸€èµ·æå‡ï¼‰
let xp = 0;      // ç»éªŒæ¡ï¼ˆ5 å³å‡çº§ï¼‰
let current = null;
let locked = false; // é˜²æ­¢ä¸€é¢˜å¤šæ¬¡ç‚¹é€‰

const P = [
  { name:"è€å¸ˆ", score:0, streak:0 },
  { name:"å­¦ç”Ÿ", score:0, streak:0 },
];
let turn = 0; // 0=P1 1=P2

/* ====== DOM ====== */
const media = document.getElementById("media");
const choicesBox = document.getElementById("choices");
const msg = document.getElementById("msg");
const countEl = document.getElementById("count");
const levelEl = document.getElementById("level");
const hintEl = document.getElementById("hint");
const bar = document.getElementById("bar");
const focusWord = document.getElementById("focusWord");

const tagP1 = document.getElementById("tagP1");
const tagP2 = document.getElementById("tagP2");
const p1ScoreEl = document.getElementById("p1Score");
const p2ScoreEl = document.getElementById("p2Score");
const p1StreakEl = document.getElementById("p1Streak");
const p2StreakEl = document.getElementById("p2Streak");

document.getElementById("nextBtn").addEventListener("click", () => newRound(true));
document.getElementById("resetBtn").addEventListener("click", resetGame);
document.getElementById("swapBtn").addEventListener("click", swapTurn);
document.getElementById("speakBtn").addEventListener("click", () => speak(current?.zh || ""));

/* ====== TTSï¼šæ›´æ¸…æ¥š ====== */
const ttsOn = document.getElementById("ttsOn");
const voiceSel = document.getElementById("voiceSel");
const rateSel = document.getElementById("rateSel");

function loadVoices(){
  const all = speechSynthesis.getVoices();
  const zh = all.filter(v => /zh|cmn/i.test(v.lang) || /Chinese/i.test(v.name));
  const list = zh.length ? zh : all;
  voiceSel.innerHTML = "";
  list.forEach((v, idx) => {
    const opt = document.createElement("option");
    opt.value = String(idx);
    opt.textContent = `${v.name} (${v.lang})`;
    voiceSel.appendChild(opt);
  });
  if(zh.length){
    const defaultIndex = list.indexOf(zh[0]);
    voiceSel.value = String(defaultIndex);
  }else{
    voiceSel.value = "0";
  }
}
if("speechSynthesis" in window){
  loadVoices();
  speechSynthesis.onvoiceschanged = loadVoices;
}
function speak(text){
  if(!ttsOn.checked) return;
  if(!("speechSynthesis" in window)) return;
  if(!text) return;

  const all = speechSynthesis.getVoices();
  const idx = Number(voiceSel.value || 0);
  const v = all[idx] || all.find(x => /zh|cmn/i.test(x.lang)) || null;

  const u = new SpeechSynthesisUtterance(text);
  u.lang = "zh-CN";
  if(v) u.voice = v;
  u.rate = Number(rateSel.value || 0.85);
  u.pitch = 1.0;
  u.volume = 1.0;

  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/* ====== éŸ³æ•ˆï¼ˆè½»é‡ï¼‰ ====== */
let audioCtx = null;
function beep(freq, dur=0.08){
  try{
    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "sine";
    o.frequency.value = freq;
    g.gain.value = 0.06;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    setTimeout(()=>{ o.stop(); }, dur*1000);
  }catch(e){}
}

/* ====== å½©å¸¦ï¼ˆè½»é‡ï¼‰ ====== */
const cvs = document.getElementById("confetti");
const ctx = cvs.getContext("2d");
let conf = [];
function resize(){ cvs.width = innerWidth; cvs.height = innerHeight; }
addEventListener("resize", resize); resize();

function shootConfetti(){
  const n = 90;
  for(let i=0;i<n;i++){
    conf.push({
      x: innerWidth*0.62 + (Math.random()-0.5)*160,
      y: innerHeight*0.22,
      vx: (Math.random()-0.5)*10,
      vy: Math.random()*-9 - 6,
      g: 0.22 + Math.random()*0.08,
      r: 3 + Math.random()*4,
      a: 1
    });
  }
}
function tick(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  conf = conf.filter(p => p.a > 0);
  for(const p of conf){
    p.vy += p.g;
    p.x += p.vx;
    p.y += p.vy;
    p.a -= 0.012;
    ctx.globalAlpha = Math.max(p.a,0);
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = "rgba(255,255,255,1)";
    ctx.fill();
  }
  ctx.globalAlpha = 1;
  requestAnimationFrame(tick);
}
tick();

/* ====== éš¾åº¦ï¼šè‡ªåŠ¨å¢åŠ  ====== */
function choiceCount(){
  if(level <= 1) return 3;
  if(level === 2) return 4;
  return 5;
}
function hintText(item){
  if(level <= 2) return item.hint;
  if(level === 3){
    const map = { "å°":"å°", "é•¿":"é•¿", "åµ":"å£°éŸ³", "å¿«":"é€Ÿåº¦", "å‡†":"å‡†ç¡®", "å¾ˆå¤§":"å¾ˆå¤§" };
    return map[item.hint] || item.hint;
  }
  return (Math.random() < 0.55) ? "â€”" : item.hint;
}
function setProgress(){
  const need = 5;
  const pct = Math.min(100, (xp / need) * 100);
  bar.style.width = pct + "%";
}
function levelUpIfNeeded(){
  const need = 5;
  if(xp >= need){
    xp = 0;
    level += 1;
    levelEl.textContent = String(level);
    msg.textContent = `å‡çº§ï¼ç°åœ¨ç­‰çº§ ${level}ï¼šé€‰é¡¹æ›´å¤šï¼Œæç¤ºæ›´å°‘ã€‚`;
    msg.className = "msg ok";
    shootConfetti();
    beep(880, 0.10);
    beep(990, 0.10);
  }
  setProgress();
}

/* ====== å·¥å…·ï¼šshuffle ====== */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* ====== æ¸²æŸ“ ====== */
function renderMedia(item){
  media.innerHTML = "";
  const img = new Image();
  img.alt = item.zh;
  img.src = item.img;
  img.onload = () => media.appendChild(img);
  img.onerror = () => { media.textContent = "å›¾ç‰‡åŠ è½½å¤±è´¥ï¼ˆè¯·æ£€æŸ¥æ–‡ä»¶å/ç½‘ç»œï¼‰"; };
}

function refreshTurnUI(){
  tagP1.classList.toggle("active", turn === 0);
  tagP2.classList.toggle("active", turn === 1);
  tagP1.innerHTML = `<span class="dot"></span>${P[0].name} å›åˆ`;
  tagP2.innerHTML = `<span class="dot"></span>${P[1].name} å›åˆ`;

  p1ScoreEl.textContent = String(P[0].score);
  p2ScoreEl.textContent = String(P[1].score);
  p1StreakEl.textContent = String(P[0].streak);
  p2StreakEl.textContent = String(P[1].streak);
}

function swapTurn(){
  turn = 1 - turn;
  refreshTurnUI();
  msg.textContent = `${P[turn].name} å…ˆæ‰‹ã€‚ç‚¹å‡»â€œä¸‹ä¸€é¢˜â€å¼€å§‹ã€‚`;
  msg.className = "msg";
}

function resetGame(){
  count = 0; level = 1; xp = 0;
  current = null; locked = false;
  P[0].score = 0; P[0].streak = 0;
  P[1].score = 0; P[1].streak = 0;
  turn = 0;

  countEl.textContent = "0";
  levelEl.textContent = "1";
  hintEl.textContent = "â€”";
  focusWord.textContent = "â€”";
  choicesBox.innerHTML = "";
  media.innerHTML = "";
  msg.textContent = "é‡ç½®å®Œæˆã€‚è€å¸ˆå…ˆç­”ç¬¬ä¸€é¢˜ã€‚";
  msg.className = "msg";
  setProgress();
  refreshTurnUI();
  newRound(true);
}

/* ====== å›åˆå‡ºé¢˜ ======
   autoAdvance: true è¡¨ç¤ºå‡ºé¢˜åè‡ªåŠ¨æœ—è¯»
===================== */
function newRound(autoAdvance=false){
  if(locked) return;
  locked = true;
  setTimeout(()=>locked=false, 250); // å°é˜²æŠ–

  current = bank[Math.floor(Math.random()*bank.length)];
  count += 1;
  countEl.textContent = String(count);

  renderMedia(current);

  const ht = hintText(current);
  hintEl.textContent = ht;
  focusWord.textContent = current.zh;

  const k = choiceCount();
  const others = shuffle(bank.filter(x => x.zh !== current.zh)).slice(0, Math.max(0, k-1)).map(x => x.zh);
  const opts = shuffle([current.zh, ...others]);

  choicesBox.innerHTML = "";
  opts.forEach(opt => {
    const b = document.createElement("button");
    b.className = "choice";
    b.textContent = opt;
    b.addEventListener("click", () => choose(opt, b));
    choicesBox.appendChild(b);
  });

  msg.textContent = `è½®åˆ° ${P[turn].name}ï¼šçœ‹å›¾ç‰‡ï¼Œé€‰æ­£ç¡®çš„ä¸­æ–‡è¯ã€‚`;
  msg.className = "msg";
  refreshTurnUI();

  if(autoAdvance) speak(current.zh);
}

/* ====== ä½œç­” ====== */
function choose(opt, btn){
  if(!current) return;

  if(opt === current.zh){
    P[turn].score += 1;
    P[turn].streak += 1;
    xp += 1;

    const bonus = (P[turn].streak >= 3) ? ` è¿å¯¹${P[turn].streak}é¢˜ï¼` : "";
    msg.textContent = `ç­”å¯¹äº†ï¼ã€Œ${current.zh}ã€ã€‚${bonus} è½®åˆ°å¯¹æ‰‹ä¸‹ä¸€é¢˜ã€‚`;
    msg.className = "msg ok";

    beep(660, 0.08);
    if(P[turn].streak >= 2) shootConfetti();
    speak("ç­”å¯¹äº†ï¼Œ" + current.zh);

    levelUpIfNeeded();
    refreshTurnUI();

    // æ¢äºº
    turn = 1 - turn;
    setTimeout(() => newRound(true), 850);
  }else{
    // ç­”é”™ï¼šæœ¬å›åˆè¿èƒœå½’é›¶ï¼Œä½†ä¸æ¢é¢˜ï¼Œå…è®¸å†è¯•ä¸€æ¬¡
    P[turn].streak = 0;
    btn.classList.add("wrong");
    msg.textContent = `å†è¯•ä¸€æ¬¡ï¼Œ${P[turn].name}ã€‚æç¤ºï¼š${hintText(current)}`;
    msg.className = "msg bad";
    beep(220, 0.10);
    speak("å†è¯•ä¸€æ¬¡");
    refreshTurnUI();
    setTimeout(()=>btn.classList.remove("wrong"), 520);
  }
}

/* start */
levelEl.textContent = String(level);
setProgress();
refreshTurnUI();
newRound(true);
</script>

</body>
</html>
